(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();window.focus();let a,d,u,h,x,r,N;const w=1,l=3;let f,v,M;const b=document.getElementById("score"),z=document.getElementById("instructions"),j=document.getElementById("results"),A=document.getElementById("resultscore");X();function R(){M=1+Math.random()*1-.5}var B=new Howl({src:["sounds/box_placed_b.mp3"]}),L=new Howl({src:["sounds/box_placed_c.mp3"]}),C=new Howl({src:["sounds/bg_music.mp3"],loop:!0,volume:.6}),V=new Howl({src:["sounds/game_over2.mp3"],volume:.2});function X(){f=!0,v=!1,x=0,r=[],N=[],R();const e=window.innerWidth/window.innerHeight,t=10,o=t/e;h=new CANNON.World,h.gravity.set(0,-10,0),h.broadphase=new CANNON.NaiveBroadphase,h.solver.iterations=40,a=new THREE.OrthographicCamera(t/-2,t/2,o/2,o/-2,0,100),a.position.set(4,4,4),a.lookAt(0,0,0),d=new THREE.Scene,E(0,0,l,l),E(-10,0,l,l,"x");const i=new THREE.AmbientLight(16777215,.6);d.add(i);const n=new THREE.DirectionalLight(16777215,.6);n.position.set(10,20,0),d.add(n);const s=new THREE.HemisphereLight(16777147,526368,.2);d.add(s),u=new THREE.WebGLRenderer({antialias:!0}),u.setSize(window.innerWidth,window.innerHeight),u.setAnimationLoop($),document.body.appendChild(u.domElement)}function S(){if(f=!1,v=!1,x=0,r=[],N=[],C.play(),z&&(z.style.display="none"),j&&(j.style.display="none"),b&&(b.innerText=0),h)for(;h.bodies.length>0;)h.remove(h.bodies[0]);if(d){for(;d.children.find(e=>e.type=="Mesh");){const e=d.children.find(t=>t.type=="Mesh");d.remove(e)}E(0,0,l,l),E(-10,0,l,l,"x")}a&&(a.position.set(4,4,4),a.lookAt(0,0,0))}function E(e,t,o,i,n){const s=w*r.length,c=W(e,s,t,o,i,!1);c.direction=n,r.push(c)}function P(e,t,o,i){const n=w*(r.length-1),s=W(e,n,t,o,i,!0);N.push(s)}function W(e,t,o,i,n,s){const c=new THREE.BoxGeometry(i,w,n),p=new THREE.Color(`hsl(${180+r.length*4}, 100%, 50%)`),H=new THREE.MeshLambertMaterial({color:p}),g=new THREE.Mesh(c,H);g.position.set(e,t,o),d.add(g),d.background=new THREE.Color(`hsl(${0+r.length*4}, 60%, 80%)`);const O=new CANNON.Box(new CANNON.Vec3(i/2,w/2,n/2));let m=s?5:0;m*=i/l,m*=n/l;const y=new CANNON.Body({mass:m,shape:O});return y.position.set(e,t,o),h.addBody(y),{threejs:g,cannonjs:y,width:i,depth:n}}function Z(e,t,o,i){const n=e.direction,s=n=="x"?t:e.width,c=n=="z"?t:e.depth;e.width=s,e.depth=c,e.threejs.scale[n]=t/o,e.threejs.position[n]-=i/2,e.cannonjs.position[n]-=i/2;const p=new CANNON.Box(new CANNON.Vec3(s/2,w/2,c/2));e.cannonjs.shapes=[],e.cannonjs.addShape(p)}window.addEventListener("mousedown",T);window.addEventListener("touchstart",T);window.addEventListener("keydown",function(e){if(e.key==" "){e.preventDefault(),T();return}if(e.key=="R"||e.key=="r"){e.preventDefault(),S();return}});function T(){f?S():D()}function D(){if(v)return;B.volume(Math.random()+.2),L.volume(Math.random()),B.play(),L.play();const e=r[r.length-1],t=r[r.length-2],o=e.direction,i=o=="x"?e.width:e.depth,n=e.threejs.position[o]-t.threejs.position[o],s=Math.abs(n),c=i-s;if(c>0){Z(e,c,i,n);const p=(c/2+s/2)*Math.sign(n),H=o=="x"?e.threejs.position.x+p:e.threejs.position.x,g=o=="z"?e.threejs.position.z+p:e.threejs.position.z,O=o=="x"?s:e.width,m=o=="z"?s:e.depth;P(H,g,O,m);const y=o=="x"?e.threejs.position.x:-10,_=o=="z"?e.threejs.position.z:-10,k=e.width,q=e.depth,G=o=="x"?"z":"x";b&&(b.innerText=r.length-1),E(y,_,k,q,G)}else I()}function I(){const e=r[r.length-1];P(e.threejs.position.x,e.threejs.position.z,e.width,e.depth),h.remove(e.cannonjs),d.remove(e.threejs),C.stop(),V.play(),A&&(A.innerText=r.length-2),v=!0,j&&!f&&(j.style.display="flex")}function $(e){if(x){const o=e-x;var t=.004+(r.length-1)/2e4;const i=r[r.length-1],n=r[r.length-2];!v&&(!f||f&&i.threejs.position[i.direction]<n.threejs.position[i.direction]+M)?(i.threejs.position[i.direction]+=t*o,i.cannonjs.position[i.direction]+=t*o,i.threejs.position[i.direction]>10&&I()):f&&(D(),R()),a.position.y<w*(r.length-2)+4&&(a.position.y+=t*o),F(o),u.render(d,a)}x=e}function F(e){h.step(e/1e3),N.forEach(t=>{t.threejs.position.copy(t.cannonjs.position),t.threejs.quaternion.copy(t.cannonjs.quaternion)})}window.addEventListener("resize",()=>{console.log("resize",window.innerWidth,window.innerHeight);const o=10/(window.innerWidth/window.innerHeight);a.top=o/2,a.bottom=o/-2,u.setSize(window.innerWidth,window.innerHeight),u.render(d,a)});
